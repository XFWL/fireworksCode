<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>
<style>
  * {
    padding: 0;
    margin: 0;
  }


  div {
    position: relative;
    margin: 15px auto;
    width: 800px;
    height: 600px;
    display: block;
    background-color: rgb(219, 121, 121);
  }

  canvas {
    /* position: absolute; */
    display: block;
    border: 3px solid rgba(0, 0, 0, 1);
    margin: 15px auto;
  }

  video {
    border: 3px solid rgba(0, 0, 0, 1);
    /* display: block; */
    margin: 15px auto;
    /* box-sizing: content-box; */
    box-sizing: border-box;
  }

  button {
    display: block;
    margin: 15px auto;
    transform: translate(0, 0) scale(1);
  }
</style>

<body>
  <canvas id="canvas1" width="800" height="600"></canvas>
  <script>
    const canvas1 = document.getElementById('canvas1')
    const ctx = canvas1.getContext('2d')

    // const img = new Image()
    // img.src = './src/image/bachong.jpg'
    // img.onload = function () {
    //   let imageWidth = 702
    //   let imageHeight = 600
    //   let centerX = 400 - imageWidth / 2
    //   let centerY = 300 - imageHeight / 2
    //   ctx.drawImage(img, centerX, centerY, 702, 600)

    //   // (提取的x，提取的y，提取的w，提取的h)
    //   const imageData = ctx.getImageData(0, 0, 800, 600)
    //   console.log(imageData);
    //   // 每个像素是四个元素为一组，分别对应 r、g、b、a
    //   for (let i = 0; i < imageData.data.length; i += 4) {
    //     // 计算当前像素的平均值
    //     let avg = (
    //       imageData.data[i] +
    //       imageData.data[i + 1] +
    //       imageData.data[i + 2]
    //     ) / 3
    //     let diffNum = 30
    //     imageData.data[i] = avg - diffNum
    //     imageData.data[i + 1] = avg - diffNum
    //     imageData.data[i + 2] = avg - diffNum

    //     // imageData.data[i] = imageData.data[i] - diffNum
    //     // imageData.data[i + 1] = imageData.data[i + 1] - diffNum
    //     // imageData.data[i + 2] = imageData.data[i + 2] - diffNum

    //     imageData.data[i + 3] = 255
    //   }
    //   // (imageData序列, 在画布中放置这个图层的x, 在画布中放置这个图层的y, 从这个图层的x开始显示, 从这个图层的y开始显示, 显示的w, 显示的h)
    //   ctx.putImageData(imageData, 0, 0, 50, 0, 351, 300)

    //   for (let i = 0; i < imageData.data.length; i += 4) {
    //     // 计算当前像素的平均值
    //     let avg = (
    //       imageData.data[i] +
    //       imageData.data[i + 1] +
    //       imageData.data[i + 2]
    //     ) / 3
    //     let diffNum = 60
    //     imageData.data[i] = avg - diffNum
    //     imageData.data[i + 1] = avg - diffNum
    //     imageData.data[i + 2] = avg - diffNum

    //     imageData.data[i + 3] = 255
    //   }
    //   // (imageData序列, 在画布中放置这个图层的x, 在画布中放置这个图层的y, 从这个图层的x开始显示, 从这个图层的y开始显示, 显示的w, 显示的h)
    //   ctx.putImageData(imageData, 0, 0, 400, 0, 351, 300)

    //   for (let i = 0; i < imageData.data.length; i += 4) {
    //     // 计算当前像素的平均值
    //     let avg = (
    //       imageData.data[i] +
    //       imageData.data[i + 1] +
    //       imageData.data[i + 2]
    //     ) / 3
    //     let diffNum = -30
    //     imageData.data[i] = avg - diffNum
    //     imageData.data[i + 1] = avg - diffNum
    //     imageData.data[i + 2] = avg - diffNum

    //     imageData.data[i + 3] = 255
    //   }
    //   // (imageData序列, 在画布中放置这个图层的x, 在画布中放置这个图层的y, 从这个图层的x开始显示, 从这个图层的y开始显示, 显示的w, 显示的h)
    //   ctx.putImageData(imageData, 0, 0, 50, 300, 351, 300)

    //   for (let i = 0; i < imageData.data.length; i += 4) {
    //     // 计算当前像素的平均值
    //     let avg = (
    //       imageData.data[i] +
    //       imageData.data[i + 1] +
    //       imageData.data[i + 2]
    //     ) / 3
    //     let diffNum = -60
    //     imageData.data[i] = avg - diffNum
    //     imageData.data[i + 1] = avg - diffNum
    //     imageData.data[i + 2] = avg - diffNum

    //     imageData.data[i + 3] = 255
    //   }
    //   // (imageData序列, 在画布中放置这个图层的x, 在画布中放置这个图层的y, 从这个图层的x开始显示, 从这个图层的y开始显示, 显示的w, 显示的h)
    //   ctx.putImageData(imageData, 0, 0, 400, 300, 351, 300)
    // }


    const img = new Image()
    img.src = './src/image/bachong.jpg'
    img.onload = function () {
      let imageWidth = 702
      let imageHeight = 600
      let centerX = 400 - imageWidth / 2
      let centerY = 300 - imageHeight / 2
      ctx.drawImage(img, centerX, centerY, 702, 600)

      // (提取的x，提取的y，提取的w，提取的h)
      const imageData = ctx.getImageData(centerX, centerY, imageWidth, imageHeight)
      console.log(imageData);
      // 每个像素是四个元素为一组，分别对应 r、g、b、a
      for (let i = 0; i < imageData.data.length; i += 4) {
        // 计算当前像素的平均值
        let avg = (
          imageData.data[i] +
          imageData.data[i + 1] +
          imageData.data[i + 2]
        ) / 3
        let diffNum = 30
        imageData.data[i] = avg - diffNum
        imageData.data[i + 1] = avg - diffNum
        imageData.data[i + 2] = avg - diffNum

        // imageData.data[i] = imageData.data[i] - diffNum
        // imageData.data[i + 1] = imageData.data[i + 1] - diffNum
        // imageData.data[i + 2] = imageData.data[i + 2] - diffNum

        imageData.data[i + 3] = 255
      }
      // (imageData序列, 在画布中放置这个图层的x, 在画布中放置这个图层的y, 从这个图层的x开始显示, 从这个图层的y开始显示, 显示的w, 显示的h)
      ctx.putImageData(imageData, centerX, centerY, imageData.width / 2, 0, imageData.width / 2, imageHeight / 2)
    }


  </script>

</body>

</html>